{% extends "base.html" %}

{% block content %}
<h2>Notes</h2>
<p>Create and manage your notes. Add tags to organize your content.</p>

<div style="margin: 20px 0;">
    <div style="margin-bottom: 20px;">
        <input type="text" id="note-title" placeholder="Note title" style="width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 4px;">
        <textarea id="note-content" placeholder="Type your note here..." style="width: 100%; min-height: 200px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; resize: vertical;"></textarea>
    </div>
    
    <div style="margin-bottom: 20px;">
        <input type="text" id="note-tags" placeholder="Add tags (comma separated)" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;">
    </div>
    
    <button class="btn" id="save-note">Save Note</button>
</div>

<hr style="margin: 30px 0;">

<h3>Your Notes</h3>
<div id="notes-list">
    <p>Loading your notes...</p>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Load notes
        loadNotes();
        
        // Save note button handler
        document.getElementById('save-note').addEventListener('click', saveNote);
    });
    
    function loadNotes() {
        fetch('/api/notes')
            .then(response => response.json())
            .then(notes => {
                const notesList = document.getElementById('notes-list');
                
                if (notes.length === 0) {
                    notesList.innerHTML = '<p>You don\'t have any notes yet.</p>';
                    return;
                }
                
                notesList.innerHTML = '';
                
                notes.forEach(note => {
                    const noteElement = document.createElement('div');
                    noteElement.style.background = '#f8f9fa';
                    noteElement.style.padding = '15px';
                    noteElement.style.borderRadius = '8px';
                    noteElement.style.marginBottom = '15px';
                    
                    noteElement.innerHTML = `
                        <h4>${note.title}</h4>
                        <p>${note.content.substring(0, 100)}${note.content.length > 100 ? '...' : ''}</p>
                        <div style="margin-top: 10px;">
                            ${note.tags.map(tag => `<span style="background: #6b8cae; color: white; padding: 3px 8px; border-radius: 20px; font-size: 12px; margin-right: 5px;">${tag}</span>`).join('')}
                        </div>
                        <div style="margin-top: 10px;">
                            <button onclick="editNote('${note.id}')" class="btn" style="padding: 5px 10px; font-size: 14px;">Edit</button>
                            <button onclick="deleteNote('${note.id}')" class="btn btn-accent" style="padding: 5px 10px; font-size: 14px;">Delete</button>
                        </div>
                    `;
                    
                    notesList.appendChild(noteElement);
                });
            })
            .catch(error => {
                console.error('Error loading notes:', error);
                document.getElementById('notes-list').innerHTML = '<p>Error loading notes. Please try again.</p>';
            });
    }
    
    function saveNote() {
        const title = document.getElementById('note-title').value || 'Untitled Note';
        const content = document.getElementById('note-content').value;
        const tags = document.getElementById('note-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
        
        if (!content) {
            alert('Please enter some note content');
            return;
        }
        
        fetch('/api/notes', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                title: title,
                content: content,
                tags: tags
            })
        })
        .then(response => response.json())
        .then(note => {
            // Clear the form
            document.getElementById('note-title').value = '';
            document.getElementById('note-content').value = '';
            document.getElementById('note-tags').value = '';
            
            // Reload notes
            loadNotes();
            
            alert('Note saved successfully!');
        })
        .catch(error => {
            console.error('Error saving note:', error);
            alert('Error saving note. Please try again.');
        });
    }
    
    function editNote(noteId) {
        // In a real application, you would implement a proper edit form
        alert('Edit functionality would be implemented here. Note ID: ' + noteId);
    }
    
    function deleteNote(noteId) {
        if (confirm('Are you sure you want to delete this note?')) {
            fetch(`/api/notes/${noteId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(result => {
                // Reload notes
                loadNotes();
                alert('Note deleted successfully!');
            })
            .catch(error => {
                console.error('Error deleting note:', error);
                alert('Error deleting note. Please try again.');
            });
        }
    }
</script>
{% endblock %}